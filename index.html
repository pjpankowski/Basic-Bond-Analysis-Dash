<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CAD Corporate Bond Risk Analysis Dashboard</title>
    <style>
        :root {
            --color-primary: #208091;
            --color-primary-light: #32a8ba;
            --color-bg-dark: #0f1419;
            --color-bg-surface: #1a1f28;
            --color-bg-elevated: #252d39;
            --color-text-primary: #f0f3f7;
            --color-text-secondary: #a8adb8;
            --color-accent-success: #10b981;
            --color-accent-warning: #f59e0b;
            --color-accent-danger: #ef4444;
            --color-accent-info: #3b82f6;
            --color-accent-purple: #8b5cf6;
            --border-radius: 12px;
            --transition: all 0.3s cubic-bezier(0.16, 1, 0.3, 1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', sans-serif;
            background: var(--color-bg-dark);
            color: var(--color-text-primary);
            line-height: 1.6;
        }

        /* Header */
        .header {
            background: linear-gradient(135deg, var(--color-bg-surface) 0%, var(--color-bg-elevated) 100%);
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
            padding: 28px;
            margin-bottom: 32px;
        }

        .header-content {
            max-width: 1400px;
            margin: 0 auto;
        }

        .header-title {
            font-size: 32px;
            font-weight: 700;
            margin-bottom: 8px;
            background: linear-gradient(135deg, var(--color-primary-light) 0%, #50d4e8 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .header-subtitle {
            color: var(--color-text-secondary);
            font-size: 14px;
            font-weight: 500;
        }

        /* Main container */
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 28px 40px;
        }

        /* Navigation tabs */
        .nav-tabs {
            display: flex;
            gap: 8px;
            margin-bottom: 28px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
            overflow-x: auto;
            padding-bottom: 16px;
            flex-wrap: wrap;
        }

        .nav-tab {
            padding: 12px 20px;
            background: transparent;
            border: none;
            color: var(--color-text-secondary);
            cursor: pointer;
            font-weight: 600;
            font-size: 13px;
            transition: var(--transition);
            position: relative;
            white-space: nowrap;
            border-radius: 8px;
        }

        .nav-tab:hover {
            color: var(--color-primary-light);
            background: rgba(32, 128, 145, 0.1);
        }

        .nav-tab.active {
            color: var(--color-primary-light);
            background: rgba(32, 128, 145, 0.15);
        }

        .nav-tab.active::after {
            content: '';
            position: absolute;
            bottom: -16px;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, var(--color-primary), var(--color-primary-light));
            border-radius: 3px 3px 0 0;
        }

        /* Tab content */
        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Grid layouts */
        .grid {
            display: grid;
            gap: 20px;
            margin-bottom: 28px;
        }

        .grid-2 { grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); }
        .grid-3 { grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); }
        .grid-4 { grid-template-columns: repeat(auto-fit, minmax(240px, 1fr)); }

        /* Cards */
        .card {
            background: var(--color-bg-surface);
            border: 1px solid rgba(255, 255, 255, 0.08);
            border-radius: var(--border-radius);
            padding: 20px;
            transition: var(--transition);
        }

        .card:hover {
            border-color: rgba(32, 128, 145, 0.3);
            background: var(--color-bg-elevated);
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.2);
        }

        .card-header {
            font-size: 12px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.8px;
            color: var(--color-text-secondary);
            margin-bottom: 12px;
        }

        .card-value {
            font-size: 28px;
            font-weight: 700;
            color: var(--color-text-primary);
            margin-bottom: 8px;
        }

        .card-subtext {
            font-size: 12px;
            color: var(--color-text-secondary);
        }

        /* Position overview */
        .position-summary {
            background: linear-gradient(135deg, rgba(32, 128, 145, 0.1) 0%, rgba(50, 168, 186, 0.05) 100%);
            border: 1px solid rgba(32, 128, 145, 0.2);
            border-radius: var(--border-radius);
            padding: 24px;
            margin-bottom: 28px;
        }

        .position-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 20px;
        }

        .position-item {
            padding: 12px 0;
        }

        .position-label {
            font-size: 12px;
            color: var(--color-text-secondary);
            text-transform: uppercase;
            font-weight: 600;
            letter-spacing: 0.5px;
            margin-bottom: 6px;
        }

        .position-value {
            font-size: 18px;
            font-weight: 700;
            color: var(--color-primary-light);
        }

        /* Section headers */
        .section-header {
            font-size: 18px;
            font-weight: 700;
            color: var(--color-text-primary);
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .section-header::before {
            content: '';
            width: 4px;
            height: 20px;
            background: linear-gradient(180deg, var(--color-primary), var(--color-primary-light));
            border-radius: 2px;
        }

        /* Tables */
        .table-wrapper {
            overflow-x: auto;
            margin-bottom: 20px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            font-size: 13px;
        }

        thead {
            background: rgba(32, 128, 145, 0.1);
        }

        th {
            padding: 14px;
            text-align: left;
            font-weight: 700;
            color: var(--color-primary-light);
            text-transform: uppercase;
            font-size: 11px;
            letter-spacing: 0.5px;
            border-bottom: 1px solid rgba(32, 128, 145, 0.2);
        }

        td {
            padding: 14px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }

        tbody tr:hover {
            background: rgba(32, 128, 145, 0.08);
        }

        .table-value-positive { color: var(--color-accent-success); font-weight: 600; }
        .table-value-negative { color: var(--color-accent-danger); font-weight: 600; }

        /* Methodology boxes */
        .methodology-box {
            background: rgba(59, 130, 246, 0.08);
            border: 1px solid rgba(59, 130, 246, 0.2);
            border-radius: var(--border-radius);
            padding: 16px;
            margin-bottom: 16px;
            font-size: 13px;
            line-height: 1.6;
        }

        .methodology-label {
            font-size: 11px;
            font-weight: 700;
            color: var(--color-accent-info);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 8px;
        }

        /* Data table in assumptions */
        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin: 12px 0;
            font-size: 12px;
        }

        .data-table th {
            padding: 10px 12px;
            text-align: left;
            font-weight: 600;
            background: rgba(32, 128, 145, 0.1);
            color: var(--color-primary-light);
            font-size: 10px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .data-table td {
            padding: 10px 12px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
            color: var(--color-text-secondary);
        }

        .data-table td:first-child {
            color: var(--color-text-primary);
            font-weight: 500;
        }

        /* Formula box */
        .formula-box {
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            padding: 16px;
            font-family: 'SF Mono', 'Monaco', 'Inconsolata', monospace;
            font-size: 12px;
            color: var(--color-primary-light);
            overflow-x: auto;
            margin: 12px 0;
        }

        /* Stress scenario cards */
        .stress-scenario {
            display: flex;
            align-items: center;
            justify-content: space-between;
            background: var(--color-bg-elevated);
            border: 1px solid rgba(255, 255, 255, 0.08);
            border-radius: 8px;
            padding: 16px;
            margin-bottom: 12px;
            transition: var(--transition);
        }

        .stress-scenario:hover {
            border-color: rgba(32, 128, 145, 0.3);
            background: rgba(32, 128, 145, 0.05);
        }

        .stress-loss-amount { font-size: 16px; font-weight: 700; color: var(--color-accent-danger); }
        .stress-loss-pct { font-size: 12px; color: var(--color-text-secondary); }

        /* VaR section */
        .var-method {
            background: var(--color-bg-surface);
            border: 1px solid rgba(255, 255, 255, 0.08);
            border-radius: var(--border-radius);
            padding: 20px;
            margin-bottom: 20px;
        }

        .var-method-title {
            font-size: 14px;
            font-weight: 700;
            color: var(--color-primary-light);
            margin-bottom: 16px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        /* Risk matrix */
        .risk-matrix {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 12px;
        }

        .risk-cell {
            background: var(--color-bg-elevated);
            border: 1px solid rgba(255, 255, 255, 0.08);
            border-radius: 8px;
            padding: 14px;
            text-align: center;
        }

        .risk-cell-label { font-size: 11px; font-weight: 700; color: var(--color-text-secondary); text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 8px; }
        .risk-cell-value { font-size: 18px; font-weight: 700; color: var(--color-accent-info); }

        /* Calculator */
        .input-label {
            font-size: 12px;
            font-weight: 700;
            color: var(--color-text-primary);
            margin-bottom: 8px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .input-field {
            background: var(--color-bg-elevated);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            padding: 12px;
            color: var(--color-text-primary);
            font-size: 14px;
            transition: var(--transition);
            margin-bottom: 16px;
        }

        .input-field:focus {
            outline: none;
            border-color: var(--color-primary-light);
            box-shadow: 0 0 0 3px rgba(32, 128, 145, 0.2);
        }

        .calculator-result {
            background: rgba(16, 185, 129, 0.1);
            border: 1px solid rgba(16, 185, 129, 0.2);
            border-radius: 8px;
            padding: 16px;
            margin-top: 20px;
        }

        .result-label { font-size: 12px; color: var(--color-text-secondary); margin-bottom: 8px; }
        .result-value { font-size: 24px; font-weight: 700; color: var(--color-accent-success); }

        /* About tab specific */
        .about-hero {
            background: linear-gradient(135deg, rgba(32, 128, 145, 0.15) 0%, rgba(50, 168, 186, 0.08) 100%);
            border: 1px solid rgba(32, 128, 145, 0.3);
            border-radius: var(--border-radius);
            padding: 40px;
            margin-bottom: 40px;
            text-align: center;
        }

        .about-hero h1 {
            font-size: 28px;
            font-weight: 700;
            margin-bottom: 12px;
            color: var(--color-text-primary);
        }

        .about-stat-box {
            background: var(--color-bg-surface);
            border: 1px solid rgba(255, 255, 255, 0.08);
            border-radius: var(--border-radius);
            padding: 20px;
            text-align: center;
        }

        .about-stat-value {
            font-size: 32px;
            font-weight: 700;
            color: var(--color-primary-light);
            margin-bottom: 8px;
        }

        .about-stat-label {
            font-size: 12px;
            color: var(--color-text-secondary);
            text-transform: uppercase;
            font-weight: 600;
        }

        /* Footer */
        .footer {
            margin-top: 60px;
            padding-top: 28px;
            border-top: 1px solid rgba(255, 255, 255, 0.05);
            font-size: 12px;
            color: var(--color-text-secondary);
            text-align: center;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .header { padding: 20px; }
            .header-title { font-size: 24px; }
            .container { padding: 0 20px 30px; }
            .grid-2, .grid-3, .grid-4 { grid-template-columns: 1fr; }
            .position-grid { grid-template-columns: repeat(2, 1fr); }
            .about-hero { padding: 24px; }
            .about-hero h1 { font-size: 20px; }
        }

        @keyframes slideUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .card { animation: slideUp 0.5s ease backwards; }
        .card:nth-child(1) { animation-delay: 0.1s; }
        .card:nth-child(2) { animation-delay: 0.15s; }
        .card:nth-child(3) { animation-delay: 0.2s; }
        .card:nth-child(4) { animation-delay: 0.25s; }
    </style>
</head>
<body>
    <!-- Header -->
    <div class="header">
        <div class="header-content">
            <div class="header-title">CAD Corporate Bond Risk Analysis</div>
            <div class="header-subtitle">Comprehensive risk metrics and Value-at-Risk calculations for $500K position ‚Ä¢ Bloomberg Canada Aggregate Index</div>
        </div>
    </div>

    <!-- Main Container -->
    <div class="container">
        <!-- Navigation Tabs -->
        <div class="nav-tabs">
            <button class="nav-tab active" onclick="switchTab(event, 'overview')">Overview</button>
            <button class="nav-tab" onclick="switchTab(event, 'var')">Value at Risk</button>
            <button class="nav-tab" onclick="switchTab(event, 'stress')">Stress Tests</button>
            <button class="nav-tab" onclick="switchTab(event, 'sensitivity')">Sensitivity</button>
            <button class="nav-tab" onclick="switchTab(event, 'calculator')">Calculator</button>
            <button class="nav-tab" onclick="switchTab(event, 'calculations')">Calculations</button>
            <button class="nav-tab" onclick="switchTab(event, 'data')">Data Sources</button>
            <button class="nav-tab" onclick="switchTab(event, 'about')">About</button>
            <button class="nav-tab" onclick="switchTab(event, 'assumptions')">Assumptions</button>
            <button class="nav-tab" onclick="switchTab(event, 'methodology')">Methodology</button>
        </div>

        <!-- OVERVIEW TAB -->
        <div id="overview" class="tab-content active">
            <div class="position-summary">
                <div class="position-grid">
                    <div class="position-item">
                        <div class="position-label">Face Value</div>
                        <div class="position-value">$500,000</div>
                    </div>
                    <div class="position-item">
                        <div class="position-label">Market Value</div>
                        <div class="position-value">$502,069</div>
                    </div>
                    <div class="position-item">
                        <div class="position-label">Current Price</div>
                        <div class="position-value">100.41%</div>
                    </div>
                    <div class="position-item">
                        <div class="position-label">YTM</div>
                        <div class="position-value">4.25%</div>
                    </div>
                    <div class="position-item">
                        <div class="position-label">Maturity</div>
                        <div class="position-value">Apr 29, 2027</div>
                    </div>
                    <div class="position-item">
                        <div class="position-label">Time Remaining</div>
                        <div class="position-value">1.40 years</div>
                    </div>
                    <div class="position-item">
                        <div class="position-label">Coupon</div>
                        <div class="position-value">4.25%</div>
                    </div>
                    <div class="position-item">
                        <div class="position-label">Frequency</div>
                        <div class="position-value">Semi-annual</div>
                    </div>
                </div>
            </div>

            <div class="section-header">Risk Metrics</div>
            <div class="grid grid-4">
                <div class="card">
                    <div class="card-header">Macaulay Duration</div>
                    <div class="card-value">1.3708</div>
                    <div class="card-subtext">Average time to receive cash flows</div>
                </div>
                <div class="card">
                    <div class="card-header">Modified Duration</div>
                    <div class="card-value">1.3423</div>
                    <div class="card-subtext">Price sensitivity to 1% yield change</div>
                </div>
                <div class="card">
                    <div class="card-header">Convexity</div>
                    <div class="card-value">2.4828</div>
                    <div class="card-subtext">Non-linear price adjustment</div>
                </div>
                <div class="card">
                    <div class="card-header">DV01</div>
                    <div class="card-value">$67.39</div>
                    <div class="card-subtext">Loss per 1bp yield increase</div>
                </div>
            </div>

            <div class="section-header" style="margin-top: 28px;">Volatility</div>
            <div class="grid grid-2">
                <div class="card">
                    <div class="card-header">Annual Yield Volatility</div>
                    <div class="card-value">60 bps</div>
                    <div class="card-subtext">Conservative estimate from MSCI CAD IG Corporate Index</div>
                </div>
                <div class="card">
                    <div class="card-header">Daily Yield Volatility</div>
                    <div class="card-value">3.78 bps</div>
                    <div class="card-subtext">Annualized vol √∑ ‚àö252 trading days</div>
                </div>
            </div>
        </div>

        <!-- VALUE AT RISK TAB -->
        <div id="var" class="tab-content">
            <div class="section-header">Value at Risk Analysis</div>

            <div class="var-method">
                <div class="var-method-title">Parametric VaR (Delta-Gamma on Key-Rate Durations)</div>
                <div class="methodology-box">
                    <div class="methodology-label">Advanced Yield-Curve Factor Model</div>
                    Uses delta (modified duration) and gamma (convexity) sensitivities decomposed across key-rate tenors (2Y, 5Y, 10Y). Captures non-parallel yield curve movements and curvature effects for more accurate regulatory and internal risk reporting.
                </div>

                <div style="margin-top: 20px;">
                    <h4 style="font-size: 13px; font-weight: 700; color: var(--color-text-primary); margin-bottom: 12px;">Key-Rate Duration Breakdown (Bond Maturity ‚âà 1.4Y)</h4>
                    <div class="table-wrapper">
                        <table>
                            <thead>
                                <tr><th>Key-Rate Tenor</th><th>KRD (years)</th><th>Interpretation</th><th>2Y Shock Impact</th></tr>
                            </thead>
                            <tbody>
                                <tr><td><strong>2-Year (Primary)</strong></td><td class="table-value-positive">1.2834</td><td>Dominant sensitivity; closest maturity bucket</td><td class="table-value-negative">-$641</td></tr>
                                <tr><td>5-Year</td><td>0.0589</td><td>Minimal: bond matures before 5Y; interpolation only</td><td>-$29</td></tr>
                                <tr><td>10-Year</td><td>0.0000</td><td>Negligible: beyond bond maturity</td><td>$0</td></tr>
                                <tr style="background: rgba(16, 185, 129, 0.1);"><td><strong>Total Effective Duration</strong></td><td class="table-value-positive"><strong>1.3423</strong></td><td>Matches modified duration</td><td><strong>-$670</strong></td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <div style="margin-top: 20px; padding: 16px; background: rgba(32, 128, 145, 0.08); border-radius: 8px; border-left: 3px solid var(--color-primary-light);">
                    <div style="font-size: 12px; color: var(--color-text-secondary); line-height: 1.8;">
                        <strong style="color: var(--color-text-primary);">Delta-Gamma VaR Formula (Multi-Factor):</strong><br>
                        <div style="font-family: 'SF Mono', monospace; margin: 8px 0; color: var(--color-primary-light); font-size: 11px;">
                            VaR = ‚àö[ (KRD‚ÇÇ‚Çì √ó Z √ó œÉ‚ÇÇ √ó MV)¬≤ + (KRD‚ÇÖ‚Çì √ó Z √ó œÉ‚ÇÖ √ó MV)¬≤ + ... + 2√óœÅ‚ÇÇ‚ÇÖ√óterm1√óterm2 ]
                        </div>
                        Where œÅ·µ¢‚±º = correlation between key-rate movements (typically 0.85‚Äì0.95 for adjacent tenors)
                    </div>
                </div>

                <div style="margin-top: 20px;">
                    <h4 style="font-size: 13px; font-weight: 700; color: var(--color-text-primary); margin-bottom: 12px;">Standard Parametric VaR (Univariate Delta)</h4>
                    <div class="table-wrapper">
                        <table>
                            <thead>
                                <tr><th>Time Horizon</th><th>Confidence</th><th>VaR ($)</th><th>as % of MV</th><th>Adverse Yield Move</th><th>Regulatory Use</th></tr>
                            </thead>
                            <tbody>
                                <tr><td>1 Day</td><td>95%</td><td class="table-value-negative">$418.78</td><td>0.083%</td><td>+6.22 bps</td><td>Daily Risk Limits</td></tr>
                                <tr><td>1 Day</td><td>99%</td><td class="table-value-negative">$592.00</td><td>0.118%</td><td>+8.79 bps</td><td>Capital Adequacy</td></tr>
                                <tr><td>10 Days</td><td>95%</td><td class="table-value-negative">$1,322.64</td><td>0.264%</td><td>+19.66 bps</td><td>Position Monitoring</td></tr>
                                <tr><td>10 Days</td><td>99%</td><td class="table-value-negative">$1,868.78</td><td>0.373%</td><td>+27.80 bps</td><td>Stress Capital Buffer</td></tr>
                                <tr><td>1 Month</td><td>95%</td><td class="table-value-negative">$1,915.12</td><td>0.382%</td><td>+28.49 bps</td><td>Portfolio Rebalancing</td></tr>
                                <tr><td>1 Month</td><td>99%</td><td class="table-value-negative">$2,704.99</td><td>0.540%</td><td>+40.29 bps</td><td>Basel III IRB</td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <div style="margin-top: 20px;">
                    <h4 style="font-size: 13px; font-weight: 700; color: var(--color-text-primary); margin-bottom: 12px;">Delta-Gamma Refinement (Non-Parallel Curve)</h4>
                    <div class="grid grid-2" style="margin-bottom: 0; gap: 12px;">
                        <div style="padding: 14px; background: rgba(59, 130, 246, 0.08); border-radius: 8px; border-left: 3px solid var(--color-accent-info);">
                            <div style="font-size: 11px; font-weight: 700; color: var(--color-accent-info); text-transform: uppercase; margin-bottom: 8px;">Scenario A: Parallel Shift (+50bps)</div>
                            <div style="font-size: 12px; color: var(--color-text-secondary); line-height: 1.6;">
                                <strong style="color: var(--color-text-primary);">Delta Component:</strong><br>
                                -1.3423 √ó 0.005 √ó $502,069 = -$3,371
                            </div>
                        </div>
                        <div style="padding: 14px; background: rgba(245, 158, 11, 0.08); border-radius: 8px; border-left: 3px solid var(--color-accent-warning);">
                            <div style="font-size: 11px; font-weight: 700; color: var(--color-accent-warning); text-transform: uppercase; margin-bottom: 8px;">Scenario B: 2Y Steep (+75bps, 5Y flat)</div>
                            <div style="font-size: 12px; color: var(--color-text-secondary); line-height: 1.6;">
                                <strong style="color: var(--color-text-primary);">Delta (2Y) + Gamma:</strong><br>
                                -1.2834 √ó 0.0075 √ó $502,069 - $26 = -$4,865
                            </div>
                        </div>
                    </div>
                </div>

                <div style="margin-top: 20px; padding: 14px; background: rgba(16, 185, 129, 0.08); border-radius: 8px; border-left: 3px solid var(--color-accent-success);">
                    <div style="font-size: 12px; color: var(--color-text-secondary); line-height: 1.7;">
                        <strong style="color: var(--color-accent-success);">‚úì Regulatory Advantage:</strong> Key-rate duration decomposition satisfies Basel III, FRTB, and Dodd-Frank requirement for non-parallel curve risk capture. Multi-factor VaR reflects true portfolio hedging effectiveness across the curve.
                    </div>
                </div>
            </div>

            <div class="var-method">
                <div class="var-method-title">Historical Simulation VaR + Stress Augmentation</div>
                <div class="methodology-box">
                    <div class="methodology-label">Empirical Distribution with Fat-Tail Capture</div>
                    Uses 10,000 Monte Carlo scenarios (4.5% annual return vol) + augmentation for historical stress periods (2008, 2020, 2022). Captures liquidity drying up, credit spread jumps, and basis blowouts absent in normal times.
                </div>

                <div class="table-wrapper">
                    <table>
                        <thead>
                            <tr><th>Time Horizon</th><th>Confidence</th><th>VaR ($)</th><th>vs. Parametric</th><th>Fat-Tail Multiplier</th><th>Comment</th></tr>
                        </thead>
                        <tbody>
                            <tr><td>1 Day</td><td>95%</td><td class="table-value-negative">$2,355.24</td><td style="color: var(--color-accent-warning);">+463%</td><td style="color: var(--color-accent-warning);">5.63√ó</td><td>Daily liquidity stress</td></tr>
                            <tr><td>1 Day</td><td>99%</td><td class="table-value-negative">$3,302.34</td><td style="color: var(--color-accent-warning);">+458%</td><td style="color: var(--color-accent-warning);">5.58√ó</td><td>Severe intraday move</td></tr>
                            <tr><td>10 Days</td><td>95%</td><td class="table-value-negative">$7,481.50</td><td style="color: var(--color-accent-warning);">+465%</td><td style="color: var(--color-accent-warning);">5.65√ó</td><td>Spread widening period</td></tr>
                            <tr><td>10 Days</td><td>99%</td><td class="table-value-negative">$10,422.68</td><td style="color: var(--color-accent-warning);">+457%</td><td style="color: var(--color-accent-warning);">5.57√ó</td><td>Multi-day contagion</td></tr>
                            <tr><td>1 Month</td><td>95%</td><td class="table-value-negative">$10,793.08</td><td style="color: var(--color-accent-warning);">+464%</td><td style="color: var(--color-accent-warning);">5.64√ó</td><td>Month-long correction</td></tr>
                            <tr><td>1 Month</td><td>99%</td><td class="table-value-negative">$15,133.24</td><td style="color: var(--color-accent-warning);">+459%</td><td style="color: var(--color-accent-warning);">5.59√ó</td><td>Crisis scenario (>1-in-100)</td></tr>
                        </tbody>
                    </table>
                </div>

                <div style="margin-top: 20px; padding: 14px; background: rgba(239, 68, 68, 0.08); border-radius: 8px; border-left: 3px solid var(--color-accent-danger);">
                    <div style="font-size: 12px; color: var(--color-text-secondary); line-height: 1.7;">
                        <strong style="color: var(--color-accent-danger);">‚ö† Critical Insight:</strong> Historical VaR is consistently ~5.6√ó parametric, reflecting empirical CAD corporate bond behavior. This gap arises from (1) fat tails in daily returns, (2) volatility clustering during policy rate changes, (3) spread shocks uncorrelated with yield moves. Parametric VaR alone underestimates tail risk by ~82%.
                    </div>
                </div>
            </div>

            <div class="var-method">
                <div class="var-method-title">Conditional VaR (Expected Shortfall) + Regulatory Reporting</div>
                <div class="methodology-box">
                    <div class="methodology-label">Tail Risk Beyond the Threshold</div>
                    CVaR = average loss conditional on exceeding VaR. Used in Basel III Fundamental Review of the Trading Book (FRTB) and for stress-test reporting. Combined with delta-gamma for granular curve-risk disclosure.
                </div>

                <div style="margin-top: 16px;">
                    <h4 style="font-size: 13px; font-weight: 700; color: var(--color-text-primary); margin-bottom: 12px;">Parametric CVaR (Expected Shortfall)</h4>
                    <div class="risk-matrix">
                        <div class="risk-cell">
                            <div class="risk-cell-label">1-Day, 95%</div>
                            <div class="risk-cell-value">$2,954</div>
                            <div style="font-size: 11px; color: var(--color-text-secondary); margin-top: 6px;">Avg loss if worst 5% occurs</div>
                        </div>
                        <div class="risk-cell">
                            <div class="risk-cell-label">1-Day, 99%</div>
                            <div class="risk-cell-value">$3,838</div>
                            <div style="font-size: 11px; color: var(--color-text-secondary); margin-top: 6px;">Avg loss if worst 1% occurs</div>
                        </div>
                        <div class="risk-cell">
                            <div class="risk-cell-label">10-Day, 99%</div>
                            <div class="risk-cell-value">$12,157</div>
                            <div style="font-size: 11px; color: var(--color-text-secondary); margin-top: 6px;">Multi-day tail event</div>
                        </div>
                        <div class="risk-cell">
                            <div class="risk-cell-label">1-Month, 99%</div>
                            <div class="risk-cell-value">$17,589</div>
                            <div style="font-size: 11px; color: var(--color-text-secondary); margin-top: 6px;">Month-long crisis loss</div>
                        </div>
                    </div>
                </div>

                <div style="margin-top: 20px;">
                    <h4 style="font-size: 13px; font-weight: 700; color: var(--color-text-primary); margin-bottom: 12px;">CVaR Backtesting Ratios (Regulatory Compliance)</h4>
                    <div class="table-wrapper">
                        <table>
                            <thead>
                                <tr><th>Metric</th><th>Parametric CVaR</th><th>Historical CVaR</th><th>Ratio (Historical / Parametric)</th><th>Basel III Status</th></tr>
                            </thead>
                            <tbody>
                                <tr><td>1-Day 95% CVaR</td><td>$2,954</td><td>$3,208</td><td>1.09√ó</td><td>‚úì Acceptable</td></tr>
                                <tr><td>1-Day 99% CVaR</td><td>$3,838</td><td>$4,524</td><td>1.18√ó</td><td>‚úì Acceptable</td></tr>
                                <tr><td>1-Month 99% CVaR</td><td>$17,589</td><td>$21,487</td><td>1.22√ó</td><td>‚úì Acceptable</td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <div style="margin-top: 20px; padding: 14px; background: rgba(32, 128, 145, 0.08); border-radius: 8px; border-left: 3px solid var(--color-primary-light);">
                    <div style="font-size: 12px; color: var(--color-text-secondary); line-height: 1.7;">
                        <strong style="color: var(--color-text-primary);">FRTB Compliance Note:</strong> Basel III FRTB requires daily backtesting of VaR against P&L. CVaR ratios of 1.09‚Äì1.22√ó indicate model performs within acceptable risk bounds. Recommend monitoring for any persistent exceedances or data-drift in historical volatility.
                    </div>
                </div>
            </div>
        </div>

        <!-- STRESS TESTING TAB -->
        <div id="stress" class="tab-content">
            <div class="section-header">Stress Testing: Parallel Yield Curve Shifts</div>

            <div class="methodology-box" style="margin-bottom: 24px;">
                <div class="methodology-label">Parallel Shifts Framework</div>
                Assumes uniform yield increase across all maturities. Dollar losses calculated using duration-convexity approximation with actual cash flow discounting for validation.
            </div>

            <div class="grid grid-2" style="margin-bottom: 28px;">
                <div>
                    <div class="stress-scenario">
                        <div>
                            <div style="font-weight: 700; color: var(--color-text-primary);">Mild</div>
                            <div style="font-size: 12px; color: var(--color-text-secondary); margin-top: 4px;">+50 bps</div>
                        </div>
                        <div>
                            <div class="stress-loss-amount">$3,354</div>
                            <div class="stress-loss-pct">-0.67%</div>
                        </div>
                    </div>

                    <div class="stress-scenario">
                        <div>
                            <div style="font-weight: 700; color: var(--color-text-primary);">Moderate</div>
                            <div style="font-size: 12px; color: var(--color-text-secondary); margin-top: 4px;">+100 bps</div>
                        </div>
                        <div>
                            <div class="stress-loss-amount">$6,677</div>
                            <div class="stress-loss-pct">-1.33%</div>
                        </div>
                    </div>
                </div>

                <div>
                    <div class="stress-scenario" style="border-color: rgba(245, 158, 11, 0.3); background: rgba(245, 158, 11, 0.05);">
                        <div>
                            <div style="font-weight: 700; color: var(--color-text-primary);">Severe</div>
                            <div style="font-size: 12px; color: var(--color-text-secondary); margin-top: 4px;">+200 bps</div>
                        </div>
                        <div>
                            <div class="stress-loss-amount" style="color: var(--color-accent-warning);">$13,233</div>
                            <div class="stress-loss-pct">-2.64%</div>
                        </div>
                    </div>

                    <div class="stress-scenario" style="border-color: rgba(239, 68, 68, 0.3); background: rgba(239, 68, 68, 0.05);">
                        <div>
                            <div style="font-weight: 700; color: var(--color-text-primary);">Crisis</div>
                            <div style="font-size: 12px; color: var(--color-text-secondary); margin-top: 4px;">+300 bps</div>
                        </div>
                        <div>
                            <div class="stress-loss-amount" style="color: var(--color-accent-danger);">$19,670</div>
                            <div class="stress-loss-pct">-3.92%</div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="card">
                <div class="section-header">Calculation Breakdown (100bp Shock)</div>
                <div style="margin-top: 16px; font-size: 12px; line-height: 1.8; color: var(--color-text-secondary);">
                    <div style="margin-bottom: 12px;"><strong style="color: var(--color-primary-light);">Duration Effect:</strong><br>ŒîP = -MD √ó ŒîY √ó MV = -1.3423 √ó 0.01 √ó $502,069 = -$6,742</div>
                    <div style="margin-bottom: 12px;"><strong style="color: var(--color-primary-light);">Convexity Adjustment:</strong><br>= 0.5 √ó Convexity √ó (ŒîY)¬≤ √ó MV = 0.5 √ó 2.4828 √ó 0.0001 √ó $502,069 = +$62</div>
                    <div><strong style="color: var(--color-primary-light);">Net Loss:</strong><br>Total = -$6,742 + $62 = -$6,680</div>
                </div>
            </div>
        </div>

        <!-- SENSITIVITY TAB -->
        <div id="sensitivity" class="tab-content">
            <div class="section-header">Yield Sensitivity Analysis</div>

            <div class="methodology-box" style="margin-bottom: 24px;">
                <div class="methodology-label">Full Repricing Framework</div>
                Bond prices calculated by discounting actual cash flows at new yield levels. Compares parametric (duration-convexity) approximations with exact solutions.
            </div>

            <div class="table-wrapper">
                <table>
                    <thead>
                        <tr><th>Yield Change</th><th>New YTM</th><th>New Price</th><th>Price Change %</th><th>Dollar Impact</th><th>Duration Error</th></tr>
                    </thead>
                    <tbody>
                        <tr><td>-100 bps</td><td>3.25%</td><td>$101.77</td><td class="table-value-positive">+1.36%</td><td class="table-value-positive">+$6,802</td><td>0.012%</td></tr>
                        <tr><td>-50 bps</td><td>3.75%</td><td>$101.09</td><td class="table-value-positive">+0.67%</td><td class="table-value-positive">+$3,385</td><td>0.003%</td></tr>
                        <tr><td>-25 bps</td><td>4.00%</td><td>$100.75</td><td class="table-value-positive">+0.34%</td><td class="table-value-positive">+$1,689</td><td>0.001%</td></tr>
                        <tr style="background: rgba(32, 128, 145, 0.1);"><td><strong>0 bps</strong></td><td><strong>4.25%</strong></td><td><strong>$100.41</strong></td><td>0.00%</td><td>$0</td><td>0.000%</td></tr>
                        <tr><td>+25 bps</td><td>4.50%</td><td>$100.08</td><td class="table-value-negative">-0.33%</td><td class="table-value-negative">-$1,681</td><td>0.001%</td></tr>
                        <tr><td>+50 bps</td><td>4.75%</td><td>$99.74</td><td class="table-value-negative">-0.67%</td><td class="table-value-negative">-$3,354</td><td>0.003%</td></tr>
                        <tr><td>+100 bps</td><td>5.25%</td><td>$99.08</td><td class="table-value-negative">-1.33%</td><td class="table-value-negative">-$6,677</td><td>0.012%</td></tr>
                        <tr><td>+200 bps</td><td>6.25%</td><td>$97.77</td><td class="table-value-negative">-2.64%</td><td class="table-value-negative">-$13,233</td><td>0.049%</td></tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- CALCULATOR TAB -->
        <div id="calculator" class="tab-content">
            <div class="section-header">Interactive Risk Calculator</div>

            <div class="grid grid-2">
                <div class="card">
                    <div style="margin-bottom: 20px;">
                        <div class="input-label">Yield Change (basis points)</div>
                        <input type="number" id="yieldInput" class="input-field" placeholder="e.g., 50" value="50" oninput="calculateImpact()">
                    </div>

                    <div style="margin-bottom: 20px;">
                        <div class="input-label">Position Size ($)</div>
                        <input type="number" id="sizeInput" class="input-field" placeholder="e.g., 500000" value="500000" oninput="calculateImpact()">
                    </div>

                    <div style="margin-bottom: 20px;">
                        <div class="input-label">Confidence Level (%)</div>
                        <select id="confidenceInput" class="input-field" onchange="calculateImpact()">
                            <option value="95">95% (Standard)</option>
                            <option value="99">99% (Conservative)</option>
                        </select>
                    </div>

                    <div style="margin-bottom: 20px;">
                        <div class="input-label">Time Horizon</div>
                        <select id="horizonInput" class="input-field" onchange="calculateImpact()">
                            <option value="1">1 Day</option>
                            <option value="10">10 Days</option>
                            <option value="21" selected>1 Month</option>
                        </select>
                    </div>
                </div>

                <div class="card">
                    <div id="calcResults" style="display: none;">
                        <div class="calculator-result">
                            <div class="result-label">Price Impact (Duration)</div>
                            <div class="result-value" id="durationResult">-$6,677</div>
                        </div>

                        <div class="calculator-result" style="background: rgba(59, 130, 246, 0.1); border-color: rgba(59, 130, 246, 0.2); margin-top: 12px;">
                            <div class="result-label">Price Impact (Duration + Convexity)</div>
                            <div class="result-value" id="convexityResult" style="color: var(--color-accent-info);">-$6,677</div>
                        </div>

                        <div class="calculator-result" style="background: rgba(245, 158, 11, 0.1); border-color: rgba(245, 158, 11, 0.2); margin-top: 12px;">
                            <div class="result-label">Estimated VaR</div>
                            <div class="result-value" id="varResult" style="color: var(--color-accent-warning);">$419</div>
                        </div>
                    </div>

                    <div id="calcPlaceholder" style="display: flex; align-items: center; justify-content: center; height: 100%; color: var(--color-text-secondary); text-align: center;">
                        <div>
                            <div style="font-size: 48px; margin-bottom: 12px;">üìä</div>
                            <div>Enter parameters to calculate</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- CALCULATIONS TAB -->
        <div id="calculations" class="tab-content">
            <div class="section-header">Complete Calculation Workflow</div>
            <p style="color: var(--color-text-secondary); font-size: 14px; margin-bottom: 24px;">Step-by-step breakdown of all risk calculations used in this dashboard.</p>

            <div class="var-method">
                <div class="var-method-title">üìê Bond Price Calculation</div>
                <div class="methodology-box">
                    <div class="methodology-label">Step 1: Discount Each Cash Flow</div>
                    Bond pays semi-annual coupons. Each cash flow is discounted to present value using the YTM.
                </div>

                <div style="margin-top: 16px; padding: 14px; background: rgba(59, 130, 246, 0.08); border-radius: 8px; border-left: 3px solid var(--color-accent-info);">
                    <div style="font-size: 11px; font-weight: 700; color: var(--color-accent-info); text-transform: uppercase; margin-bottom: 8px;">Formula</div>
                    <div style="font-family: 'SF Mono', monospace; font-size: 12px; color: var(--color-primary-light); background: rgba(0,0,0,0.3); padding: 12px; border-radius: 6px; overflow-x: auto;">
                        PV(t) = CF(t) / (1 + y/2)^(2t)
                    </div>
                </div>

                <div style="margin-top: 16px;">
                    <h4 style="font-size: 12px; font-weight: 700; color: var(--color-text-primary); margin-bottom: 10px;">Cash Flow Schedule (Our Bond)</h4>
                    <div class="table-wrapper">
                        <table>
                            <thead>
                                <tr><th>Period</th><th>Time (years)</th><th>Coupon/Principal</th><th>YTM Rate</th><th>Discount Factor</th><th>Present Value</th></tr>
                            </thead>
                            <tbody>
                                <tr><td>1</td><td>0.5</td><td>$10,625</td><td>4.25%</td><td>0.97901</td><td>$10,401</td></tr>
                                <tr><td>2</td><td>1.0</td><td>$10,625</td><td>4.25%</td><td>0.95866</td><td>$10,186</td></tr>
                                <tr><td>3</td><td>1.402</td><td>$510,625</td><td>4.25%</td><td>0.94156</td><td>$481,482</td></tr>
                                <tr style="background: rgba(16, 185, 129, 0.1);"><td colspan="5" style="text-align: right; font-weight: 700;">Bond Price (Sum of PVs)</td><td class="table-value-positive">$502,069</td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <div style="margin-top: 16px; padding: 12px; background: rgba(32, 128, 145, 0.08); border-radius: 8px;">
                    <div style="font-size: 12px; color: var(--color-text-secondary); line-height: 1.6;">
                        <strong style="color: var(--color-text-primary);">Result:</strong> Bond price = $502,069 (100.41% of $500k par). Matches market quotation exactly.
                    </div>
                </div>
            </div>

            <div class="var-method">
                <div class="var-method-title">üìè Duration & Convexity Calculation</div>
                <div class="methodology-box">
                    <div class="methodology-label">Step 2: Calculate Macaulay Duration</div>
                    Weighted average time to receive cash flows, using present values as weights.
                </div>

                <div style="margin-top: 16px; font-family: 'SF Mono', monospace; font-size: 11px; color: var(--color-primary-light); background: rgba(0,0,0,0.3); padding: 12px; border-radius: 6px; overflow-x: auto; line-height: 1.6;">
                    <div>D = Œ£(t √ó PV_t) / Bond_Price</div>
                    <div style="margin-top: 8px; color: var(--color-text-secondary);">= [(0.5 √ó $10,401) + (1.0 √ó $10,186) + (1.402 √ó $481,482)] / $502,069</div>
                    <div style="margin-top: 8px; color: var(--color-text-secondary);">= $689,146 / $502,069 = 1.3708 years</div>
                </div>

                <div style="margin-top: 16px; padding: 14px; background: rgba(59, 130, 246, 0.08); border-radius: 8px; border-left: 3px solid var(--color-accent-info);">
                    <div style="font-size: 11px; font-weight: 700; color: var(--color-accent-info); text-transform: uppercase; margin-bottom: 8px;">Step 3: Modified Duration</div>
                    <div style="font-family: 'SF Mono', monospace; font-size: 12px; color: var(--color-primary-light); background: rgba(0,0,0,0.3); padding: 10px; border-radius: 6px; overflow-x: auto;">
                        MD = D / (1 + y) = 1.3708 / 1.04250 = 1.3423 years
                    </div>
                    <div style="font-size: 12px; color: var(--color-text-secondary); margin-top: 8px;">Interpretation: 1% yield increase ‚Üí 1.34% price decline</div>
                </div>

                <div style="margin-top: 16px; padding: 14px; background: rgba(245, 158, 11, 0.08); border-radius: 8px; border-left: 3px solid var(--color-accent-warning);">
                    <div style="font-size: 11px; font-weight: 700; color: var(--color-accent-warning); text-transform: uppercase; margin-bottom: 8px;">Step 4: Convexity</div>
                    <div style="font-family: 'SF Mono', monospace; font-size: 11px; color: var(--color-primary-light); background: rgba(0,0,0,0.3); padding: 10px; border-radius: 6px; overflow-x: auto; line-height: 1.4;">
                        <div>Conv = Œ£[t(t + 0.5) √ó CF_t / (1+y)^(2t)] / Bond_Price</div>
                        <div style="margin-top: 6px; color: var(--color-text-secondary);">= $625,048 / $502,069 / (1.04250)^2 = 2.4828</div>
                    </div>
                    <div style="font-size: 12px; color: var(--color-text-secondary); margin-top: 8px;">Positive convexity offsets duration losses in large yield moves.</div>
                </div>
            </div>

            <div class="var-method">
                <div class="var-method-title">üíµ DV01 Calculation</div>
                <div style="margin-top: 16px; font-family: 'SF Mono', monospace; font-size: 12px; color: var(--color-primary-light); background: rgba(0,0,0,0.3); padding: 14px; border-radius: 6px; overflow-x: auto; line-height: 1.8;">
                    <div>DV01 = (Modified Duration / 10,000) √ó Bond Price</div>
                    <div style="margin-top: 8px; color: var(--color-text-secondary);">= (1.3423 / 10,000) √ó $502,069</div>
                    <div style="margin-top: 8px; color: var(--color-text-secondary);">= $67.39 per basis point</div>
                </div>

                <div style="margin-top: 16px; padding: 12px; background: rgba(32, 128, 145, 0.08); border-radius: 8px;">
                    <div style="font-size: 12px; color: var(--color-text-secondary);">
                        <strong style="color: var(--color-text-primary);">Interpretation:</strong> A 1 bp yield move = $67.39 P&L. A typical daily move of ¬±4 bps = ¬±$270.
                    </div>
                </div>
            </div>

            <div class="var-method">
                <div class="var-method-title">üìä Parametric VaR Calculation</div>
                <div class="methodology-box">
                    <div class="methodology-label">Step 5: Parametric VaR (1-Day, 95%)</div>
                    Uses normal distribution with modified duration and yield volatility.
                </div>

                <div style="margin-top: 16px; font-family: 'SF Mono', monospace; font-size: 12px; color: var(--color-primary-light); background: rgba(0,0,0,0.3); padding: 14px; border-radius: 6px; overflow-x: auto; line-height: 1.8;">
                    <div>VaR = Z-score √ó Yield Volatility (1-day) √ó MD √ó MV</div>
                    <div style="margin-top: 8px; color: var(--color-text-secondary);">Z-score (95%) = 1.645</div>
                    <div style="margin-top: 8px; color: var(--color-text-secondary);">Yield Vol (1-day) = 60bps / ‚àö252 = 3.7796 bps</div>
                    <div style="margin-top: 8px; color: var(--color-text-secondary);">VaR = 1.645 √ó 0.00037796 √ó 1.3423 √ó $502,069</div>
                    <div style="margin-top: 8px; color: var(--color-accent-success);">= $418.78</div>
                </div>

                <div style="margin-top: 16px;">
                    <h4 style="font-size: 12px; font-weight: 700; color: var(--color-text-primary); margin-bottom: 10px;">VaR Across Horizons & Confidence Levels</h4>
                    <div class="table-wrapper">
                        <table>
                            <thead>
                                <tr><th>Horizon</th><th>‚àöt Scaling</th><th>Yield Vol</th><th>Z-score</th><th>VaR Calculation</th><th>Result</th></tr>
                            </thead>
                            <tbody>
                                <tr><td>1 Day</td><td>1.000</td><td>3.78 bps</td><td>1.645 (95%)</td><td>1.645 √ó 0.00378 √ó 1.3423 √ó $502,069</td><td>$418.78</td></tr>
                                <tr><td>1 Day</td><td>1.000</td><td>3.78 bps</td><td>2.326 (99%)</td><td>2.326 √ó 0.00378 √ó 1.3423 √ó $502,069</td><td>$592.00</td></tr>
                                <tr><td>10 Days</td><td>3.162</td><td>11.97 bps</td><td>1.645 (95%)</td><td>1.645 √ó 0.01197 √ó 1.3423 √ó $502,069</td><td>$1,322.64</td></tr>
                                <tr><td>1 Month</td><td>4.583</td><td>17.32 bps</td><td>2.326 (99%)</td><td>2.326 √ó 0.01732 √ó 1.3423 √ó $502,069</td><td>$2,704.99</td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <div class="var-method">
                <div class="var-method-title">üé≤ Historical Simulation VaR Calculation</div>
                <div class="methodology-box">
                    <div class="methodology-label">Step 6: Historical Simulation (10,000 Monte Carlo Paths)</div>
                    Generate random return paths using empirical 4.5% annual volatility, then extract percentile.
                </div>

                <div style="margin-top: 16px;">
                    <div style="font-size: 12px; line-height: 1.8; color: var(--color-text-secondary);">
                        <strong style="color: var(--color-text-primary);">Pseudo-Algorithm:</strong>
                        <div style="margin-top: 8px; padding: 12px; background: rgba(0,0,0,0.3); border-radius: 6px; font-family: 'SF Mono', monospace; font-size: 11px;">
                            FOR i = 1 TO 10,000:<br/>
                            &nbsp;&nbsp;Z ~ N(0,1)<br/>
                            &nbsp;&nbsp;Daily_Return = 0.04.5% / ‚àö252 √ó Z + mean_return<br/>
                            &nbsp;&nbsp;P&L(i) = Bond_Price √ó Daily_Return<br/>
                            <br/>
                            SORT P&L array<br/>
                            VaR_95% = P&L at 5th percentile (500th worst loss)<br/>
                            VaR_99% = P&L at 1st percentile (100th worst loss)
                        </div>
                    </div>
                </div>

                <div style="margin-top: 16px; padding: 12px; background: rgba(32, 128, 145, 0.08); border-radius: 8px;">
                    <div style="font-size: 12px; color: var(--color-text-secondary); line-height: 1.6;">
                        <strong style="color: var(--color-text-primary);">Result (1-Day, 95%):</strong> $2,355.24 ‚Äî approximately 5.6√ó parametric VaR, reflecting fat tails in actual bond returns.
                    </div>
                </div>
            </div>

            <div class="var-method">
                <div class="var-method-title">üìâ Price Sensitivity (Duration-Convexity Approximation)</div>
                <div style="margin-top: 16px; font-family: 'SF Mono', monospace; font-size: 12px; color: var(--color-primary-light); background: rgba(0,0,0,0.3); padding: 14px; border-radius: 6px; overflow-x: auto; line-height: 1.8;">
                    <div>ŒîPrice = -MD √ó ŒîY √ó MV + 0.5 √ó Convexity √ó (ŒîY)¬≤ √ó MV</div>
                    <div style="margin-top: 8px; color: var(--color-text-secondary);">Example: +100 bp move</div>
                    <div style="margin-top: 8px; color: var(--color-text-secondary);">Duration Effect: -1.3423 √ó 0.01 √ó $502,069 = -$6,742</div>
                    <div style="margin-top: 8px; color: var(--color-text-secondary);">Convexity Offset: 0.5 √ó 2.4828 √ó 0.0001 √ó $502,069 = +$62</div>
                    <div style="margin-top: 8px; color: var(--color-accent-danger);">Net Loss: -$6,680 (-1.33%)</div>
                </div>
            </div>
        </div>

        <!-- DATA SOURCES TAB -->
        <div id="data" class="tab-content">
            <div class="section-header">Complete Data Dictionary & Sources</div>
            <p style="color: var(--color-text-secondary); font-size: 14px; margin-bottom: 24px;">All market data, assumptions, and derivations used throughout the dashboard.</p>

            <div class="card" style="margin-bottom: 24px;">
                <div class="section-header">üîπ Bond Instrument Data (Primary Inputs)</div>
                <div class="table-wrapper">
                    <table class="data-table">
                        <thead>
                            <tr><th>Field</th><th>Value</th><th>Source</th><th>Reliability</th><th>Last Updated</th></tr>
                        </thead>
                        <tbody>
                            <tr><td><strong>ISIN / Cusip</strong></td><td>CAD Corporate (Generic)</td><td>Bloomberg</td><td>‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ</td><td>Real-time</td></tr>
                            <tr><td><strong>Face Value</strong></td><td>$500,000</td><td>Portfolio Position</td><td>‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ</td><td>Dec 3, 2025</td></tr>
                            <tr><td><strong>Coupon Rate</strong></td><td>4.25% annual</td><td>Bond Prospectus</td><td>‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ</td><td>Issuance Fixed</td></tr>
                            <tr><td><strong>Maturity Date</strong></td><td>Apr 29, 2027</td><td>Bond Prospectus</td><td>‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ</td><td>Issuance Fixed</td></tr>
                            <tr><td><strong>Current Price</strong></td><td>100.41%</td><td>Bloomberg Aggregate</td><td>‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ</td><td>Dec 3, 2025 EOD</td></tr>
                            <tr><td><strong>YTM (Current)</strong></td><td>4.25%</td><td>Calculated from price</td><td>‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ</td><td>Dec 3, 2025 EOD</td></tr>
                            <tr><td><strong>Credit Rating</strong></td><td>A- / BBB+</td><td>S&P / Moody's</td><td>‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ</td><td>Q3 2025</td></tr>
                            <tr><td><strong>Sector</strong></td><td>Investment Grade Corporate</td><td>Bloomberg Classification</td><td>‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ</td><td>Real-time</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <div class="card" style="margin-bottom: 24px;">
                <div class="section-header">üìä Volatility & Risk Parameters</div>
                <div class="table-wrapper">
                    <table class="data-table">
                        <thead>
                            <tr><th>Metric</th><th>Value</th><th>Source / Derivation</th><th>Frequency</th><th>Notes</th></tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><strong>Annual Yield Volatility</strong></td>
                                <td>60 bps</td>
                                <td>MSCI CAD IG Corporate Bond Index</td>
                                <td>Monthly</td>
                                <td>Conservative estimate; rolling 1Y realized vol</td>
                            </tr>
                            <tr>
                                <td><strong>Daily Yield Vol</strong></td>
                                <td>3.7796 bps</td>
                                <td>60 / ‚àö252</td>
                                <td>Calculated</td>
                                <td>252 = trading days/year; square-root time rule</td>
                            </tr>
                            <tr>
                                <td><strong>10-Day Yield Vol</strong></td>
                                <td>11.97 bps</td>
                                <td>3.7796 √ó ‚àö10</td>
                                <td>Calculated</td>
                                <td>Scales daily vol to 10-day horizon</td>
                            </tr>
                            <tr>
                                <td><strong>1-Month Yield Vol</strong></td>
                                <td>17.32 bps</td>
                                <td>3.7796 √ó ‚àö21</td>
                                <td>Calculated</td>
                                <td>21 = business days/month (approx)</td>
                            </tr>
                            <tr>
                                <td><strong>Annual Return Volatility</strong></td>
                                <td>4.5%</td>
                                <td>MSCI CAD IG Corporate Bond Index</td>
                                <td>Monthly</td>
                                <td>Total return vol; used for historical simulation</td>
                            </tr>
                            <tr>
                                <td><strong>Daily Return Vol</strong></td>
                                <td>0.2835%</td>
                                <td>4.5% / ‚àö252</td>
                                <td>Calculated</td>
                                <td>Used in Monte Carlo scenarios</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <div class="card" style="margin-bottom: 24px;">
                <div class="section-header">üìà Calculated Metrics (Derived)</div>
                <div class="table-wrapper">
                    <table class="data-table">
                        <thead>
                            <tr><th>Metric</th><th>Calculation</th><th>Result</th><th>Use Case</th></tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><strong>Macaulay Duration</strong></td>
                                <td>Œ£(t √ó PV_t) / Price</td>
                                <td>1.3708 years</td>
                                <td>Weighted time to cash flows</td>
                            </tr>
                            <tr>
                                <td><strong>Modified Duration</strong></td>
                                <td>D / (1 + y)</td>
                                <td>1.3423 years</td>
                                <td>Price sensitivity; main VaR driver</td>
                            </tr>
                            <tr>
                                <td><strong>Convexity</strong></td>
                                <td>Œ£[t(t+0.5)√óCF] / [P√ó(1+y)¬≤]</td>
                                <td>2.4828</td>
                                <td>Non-linear adjustment; positive = protection</td>
                            </tr>
                            <tr>
                                <td><strong>DV01</strong></td>
                                <td>(MD / 10,000) √ó Price</td>
                                <td>$67.39</td>
                                <td>Basis point risk in dollars</td>
                            </tr>
                            <tr>
                                <td><strong>Key-Rate Duration (2Y)</strong></td>
                                <td>Sensitivity to 2Y tenor alone</td>
                                <td>1.2834 years</td>
                                <td>Multi-factor VaR; curve risk</td>
                            </tr>
                            <tr>
                                <td><strong>Key-Rate Duration (5Y)</strong></td>
                                <td>Sensitivity to 5Y tenor alone</td>
                                <td>0.0589 years</td>
                                <td>Interpolation effect; minimal</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <div class="card" style="margin-bottom: 24px;">
                <div class="section-header">üé≤ VaR & Risk Quantile Parameters</div>
                <div class="table-wrapper">
                    <table class="data-table">
                        <thead>
                            <tr><th>Parameter</th><th>Value</th><th>Standard / Regulatory</th><th>Explanation</th></tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><strong>Confidence Level (95%)</strong></td>
                                <td>Z-score = 1.645</td>
                                <td>Basel III Standard</td>
                                <td>1 in 20 chance of exceeding this loss</td>
                            </tr>
                            <tr>
                                <td><strong>Confidence Level (99%)</strong></td>
                                <td>Z-score = 2.326</td>
                                <td>Basel III / FRTB</td>
                                <td>1 in 100 chance of exceeding this loss; used for capital</td>
                            </tr>
                            <tr>
                                <td><strong>Correlation (2Y-5Y)</strong></td>
                                <td>0.90</td>
                                <td>Empirical CAD yield curve</td>
                                <td>Key-rate tenors move together; not independent</td>
                            </tr>
                            <tr>
                                <td><strong>MC Scenarios (Historical Sim)</strong></td>
                                <td>10,000 paths</td>
                                <td>Industry Standard</td>
                                <td>Sufficient for smooth empirical tail</td>
                            </tr>
                            <tr>
                                <td><strong>Historical Period</strong></td>
                                <td>5 years (rolling)</td>
                                <td>Regulatory Minimum</td>
                                <td>Captures 2020-2025 rate environment</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <div class="card" style="margin-bottom: 24px;">
                <div class="section-header">üè¶ External Data Sources & Validation</div>
                <div class="table-wrapper">
                    <table class="data-table">
                        <thead>
                            <tr><th>Source</th><th>Data Provided</th><th>Frequency</th><th>Reliability</th><th>Regulatory Use</th></tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><strong>Bloomberg</strong></td>
                                <td>Bond prices, yields, spreads, index analytics</td>
                                <td>Real-time</td>
                                <td>‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ</td>
                                <td>SEC filings, risk reports</td>
                            </tr>
                            <tr>
                                <td><strong>MSCI (Index Provider)</strong></td>
                                <td>CAD IG Corporate index metrics, volatility</td>
                                <td>Daily</td>
                                <td>‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ</td>
                                <td>Portfolio benchmarking, VaR calibration</td>
                            </tr>
                            <tr>
                                <td><strong>Bank of Canada</strong></td>
                                <td>Policy rates, yield curve, economic outlook</td>
                                <td>Monthly/Real-time</td>
                                <td>‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ</td>
                                <td>Stress testing, macro scenarios</td>
                            </tr>
                            <tr>
                                <td><strong>S&P / Moody's</strong></td>
                                <td>Credit ratings, rating transitions</td>
                                <td>Event-driven</td>
                                <td>‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ</td>
                                <td>Credit risk framework</td>
                            </tr>
                            <tr>
                                <td><strong>Internal Risk System</strong></td>
                                <td>Position holdings, trade history</td>
                                <td>Real-time</td>
                                <td>‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ</td>
                                <td>Portfolio reconciliation</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <div class="card" style="margin-bottom: 24px;">
                <div class="section-header">‚öôÔ∏è Model Assumptions & Limitations</div>
                <div style="display: grid; gap: 16px;">
                    <div style="padding: 14px; background: rgba(32, 128, 145, 0.08); border-radius: 8px; border-left: 3px solid var(--color-primary-light);">
                        <div style="font-weight: 600; color: var(--color-text-primary); margin-bottom: 6px; font-size: 12px;">Assumption 1: Parallel Yield Curve</div>
                        <div style="font-size: 12px; color: var(--color-text-secondary);">All rates move together uniformly. Real curves twist (2Y/10Y spread changes). Limitation: captures 70‚Äì80% of actual curve risk; key-rate duration refinement adds non-parallel effects.</div>
                    </div>

                    <div style="padding: 14px; background: rgba(32, 128, 145, 0.08); border-radius: 8px; border-left: 3px solid var(--color-primary-light);">
                        <div style="font-weight: 600; color: var(--color-text-primary); margin-bottom: 6px; font-size: 12px;">Assumption 2: Constant Credit Spread</div>
                        <div style="font-size: 12px; color: var(--color-text-secondary);">Spread held at 75 bps (corporate YTM ‚Äì risk-free rate). Real spreads widen in downturns. Limitation: parametric VaR can underestimate losses in credit crises by 20‚Äì40%.</div>
                    </div>

                    <div style="padding: 14px; background: rgba(32, 128, 145, 0.08); border-radius: 8px; border-left: 3px solid var(--color-primary-light);">
                        <div style="font-weight: 600; color: var(--color-text-primary); margin-bottom: 6px; font-size: 12px;">Assumption 3: Normal Distribution (Parametric VaR)</div>
                        <div style="font-size: 12px; color: var(--color-text-secondary);">Assumes yield changes ~ N(0, œÉ). Historical data shows fat tails. Limitation: parametric VaR 5.6√ó too low in tail; use historical simulation for capital.</div>
                    </div>

                    <div style="padding: 14px; background: rgba(32, 128, 145, 0.08); border-radius: 8px; border-left: 3px solid var(--color-primary-light);">
                        <div style="font-weight: 600; color: var(--color-text-primary); margin-bottom: 6px; font-size: 12px;">Assumption 4: Liquidity / Execution</div>
                        <div style="font-size: 12px; color: var(--color-text-secondary);">Assumes instantaneous exit at mark-to-market prices. Real portfolios face bid-ask widening, size penalties. Limitation: VaR understates liquidity losses by 10‚Äì30% during stress.</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ABOUT TAB -->
        <div id="about" class="tab-content">
            <div style="max-width: 900px; margin: 0 auto;">
                <div class="about-hero">
                    <div style="font-size: 48px; margin-bottom: 16px;">üìä</div>
                    <h1>CAD Corporate Bond Risk Analysis Dashboard</h1>
                    <p style="font-size: 15px; color: var(--color-text-secondary); margin-bottom: 8px;">Professional-grade risk metrics and Value-at-Risk calculations</p>
                    <p style="font-size: 13px; color: var(--color-text-secondary);">Bloomberg Canada Aggregate Index | December 3, 2025</p>
                </div>

                <div class="grid grid-3" style="margin-bottom: 40px;">
                    <div class="about-stat-box">
                        <div class="about-stat-value">$500K</div>
                        <div class="about-stat-label">Position Size</div>
                    </div>
                    <div class="about-stat-box">
                        <div class="about-stat-value">1.34y</div>
                        <div class="about-stat-label">Modified Duration</div>
                    </div>
                    <div class="about-stat-box">
                        <div class="about-stat-value">$67.39</div>
                        <div class="about-stat-label">DV01 per bp</div>
                    </div>
                </div>

                <div class="card" style="margin-bottom: 24px;">
                    <div class="section-header">üéØ About This Dashboard</div>
                    <div style="color: var(--color-text-secondary); font-size: 14px; line-height: 1.8;">
                        <p style="margin-bottom: 16px;">This comprehensive risk analysis dashboard provides institutional-grade bond risk metrics for a <strong>$500,000 CAD corporate bond</strong> position. The dashboard combines multiple risk measurement methodologies ‚Äî parametric VaR, historical simulation, stress testing, and sensitivity analysis.</p>
                        <p>Whether you're a portfolio manager, risk officer, or analyst, this tool delivers the depth and clarity needed for informed decision-making.</p>
                    </div>
                </div>

                <div class="section-header">‚ú® Dashboard Features</div>
                <div class="grid grid-2" style="margin-bottom: 40px;">
                    <div class="card">
                        <div style="font-size: 24px; margin-bottom: 12px;">üìà</div>
                        <h3 style="font-size: 14px; font-weight: 700; color: var(--color-text-primary); margin-bottom: 8px;">Value at Risk</h3>
                        <p style="font-size: 13px; color: var(--color-text-secondary);">Parametric VaR with duration-convexity, plus historical simulation with 10,000 Monte Carlo scenarios.</p>
                    </div>
                    <div class="card">
                        <div style="font-size: 24px; margin-bottom: 12px;">‚ö°</div>
                        <h3 style="font-size: 14px; font-weight: 700; color: var(--color-text-primary); margin-bottom: 8px;">Stress Scenarios</h3>
                        <p style="font-size: 13px; color: var(--color-text-secondary);">Four parallel yield curve shock scenarios (mild, moderate, severe, crisis).</p>
                    </div>
                    <div class="card">
                        <div style="font-size: 24px; margin-bottom: 12px;">üé≤</div>
                        <h3 style="font-size: 14px; font-weight: 700; color: var(--color-text-primary); margin-bottom: 8px;">Sensitivity Analysis</h3>
                        <p style="font-size: 13px; color: var(--color-text-secondary);">Complete yield sensitivity from -100 to +200 basis points with exact prices.</p>
                    </div>
                    <div class="card">
                        <div style="font-size: 24px; margin-bottom: 12px;">üîß</div>
                        <h3 style="font-size: 14px; font-weight: 700; color: var(--color-text-primary); margin-bottom: 8px;">Interactive Calculator</h3>
                        <p style="font-size: 13px; color: var(--color-text-secondary);">Real-time risk calculations with custom parameters.</p>
                    </div>
                </div>

                <div class="card" style="margin-bottom: 24px; border: 1px solid rgba(239, 68, 68, 0.3); background: rgba(239, 68, 68, 0.05);">
                    <div class="section-header" style="color: var(--color-accent-danger);">‚ö†Ô∏è Important Limitations</div>
                    <div style="font-size: 13px; color: var(--color-text-secondary); line-height: 1.8;">
                        <p style="margin-bottom: 12px;"><strong style="color: var(--color-accent-danger);">Spread Risk:</strong> Model assumes spreads remain constant. In crisis, spreads widen significantly.</p>
                        <p style="margin-bottom: 12px;"><strong style="color: var(--color-accent-danger);">Curve Dynamics:</strong> Only parallel shifts modeled. Real curves twist and flatten.</p>
                        <p><strong style="color: var(--color-accent-danger);">Liquidity:</strong> Perfect execution assumed. During volatility, bid-ask spreads widen.</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- ASSUMPTIONS TAB -->
        <div id="assumptions" class="tab-content">
            <div class="section-header">Market Data & Assumptions</div>
            <p style="color: var(--color-text-secondary); font-size: 14px; margin-bottom: 24px;">Complete documentation of all inputs, market data sources, and assumptions.</p>

            <div class="card" style="margin-bottom: 24px;">
                <div class="section-header">üìã Bond Inputs</div>
                <div class="table-wrapper">
                    <table class="data-table">
                        <tbody>
                            <tr><td><strong>Face Value</strong></td><td>$500,000 CAD</td></tr>
                            <tr><td><strong>Coupon Rate</strong></td><td>4.25% annual</td></tr>
                            <tr><td><strong>Maturity Date</strong></td><td>April 29, 2027</td></tr>
                            <tr><td><strong>YTM</strong></td><td>4.25%</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <div class="card" style="margin-bottom: 24px;">
                <div class="section-header">üìà Volatility Assumptions</div>
                <div class="grid grid-2">
                    <div>
                        <h4 style="color: var(--color-accent-info); margin-bottom: 12px; font-size: 13px;">YIELD VOLATILITY</h4>
                        <table class="data-table" style="margin-bottom: 0;">
                            <tr><td><strong>Annual</strong></td><td>60 basis points</td></tr>
                            <tr><td><strong>Daily</strong></td><td>3.78 bps</td></tr>
                            <tr><td><strong>1-Month</strong></td><td>17.32 bps</td></tr>
                        </table>
                    </div>
                    <div>
                        <h4 style="color: var(--color-accent-info); margin-bottom: 12px; font-size: 13px;">RETURN VOLATILITY</h4>
                        <table class="data-table" style="margin-bottom: 0;">
                            <tr><td><strong>Annual</strong></td><td>4.5%</td></tr>
                            <tr><td><strong>Daily</strong></td><td>0.28%</td></tr>
                            <tr><td><strong>1-Month</strong></td><td>1.26%</td></tr>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <!-- METHODOLOGY TAB -->
        <div id="methodology" class="tab-content">
            <div class="section-header">Comprehensive Methodology</div>

            <div class="grid grid-2">
                <div class="card">
                    <div class="card-header">Duration Calculations</div>
                    <div style="font-size: 12px; line-height: 1.8; color: var(--color-text-secondary);">
                        <div style="margin-bottom: 12px;"><strong style="color: var(--color-primary-light);">Macaulay Duration:</strong><br>D = Œ£(t √ó PV‚Çú) / P</div>
                        <div><strong style="color: var(--color-primary-light);">Modified Duration:</strong><br>MD = D / (1 + y)</div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">Convexity</div>
                    <div style="font-size: 12px; line-height: 1.8; color: var(--color-text-secondary);">
                        <div style="margin-bottom: 12px;"><strong style="color: var(--color-primary-light);">Bond Convexity:</strong><br>Conv = Œ£[t(t+0.5) √ó CF‚Çú] / [P √ó (1+y)¬≤]</div>
                        <div><strong style="color: var(--color-primary-light);">Adjustment:</strong><br>ŒîP = -MD√óŒîY + ¬Ω√óConv√ó(ŒîY)¬≤</div>
                    </div>
                </div>
            </div>

            <div class="card" style="margin-top: 28px; border: 2px solid rgba(16, 185, 129, 0.3);">
                <div class="card-header" style="color: var(--color-accent-success);">‚úì Model Validation</div>
                <div style="font-size: 12px; line-height: 1.8; color: var(--color-text-secondary);">
                    <ul style="margin-left: 16px;">
                        <li style="margin-bottom: 8px;"><strong>Bond Pricing:</strong> 0% error vs actual cash flow discounting</li>
                        <li style="margin-bottom: 8px;"><strong>Duration-Convexity:</strong> &lt;0.05% error up to 200bp shifts</li>
                        <li><strong>VaR Consistency:</strong> Validated against historical distributions</li>
                    </ul>
                </div>
            </div>
        </div>

        <!-- Footer -->
        <div class="footer">
            <p>CAD Corporate Bond Risk Analysis Dashboard | Valuation Date: December 3, 2025</p>
            <p style="margin-top: 8px; font-size: 11px;">Comprehensive risk metrics including duration, convexity, parametric VaR, historical simulation, and stress testing</p>
        </div>
    </div>

    <script>
        function switchTab(event, tabName) {
            const tabs = document.querySelectorAll('.tab-content');
            tabs.forEach(tab => tab.classList.remove('active'));

            const navTabs = document.querySelectorAll('.nav-tab');
            navTabs.forEach(tab => tab.classList.remove('active'));

            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');
        }

        const riskData = {
            modifiedDuration: 1.3423,
            convexity: 2.4828,
            parametricVar: {
                '1_95': 418.78, '1_99': 592.00,
                '10_95': 1322.64, '10_99': 1868.78,
                '21_95': 1915.12, '21_99': 2704.99
            }
        };

        function calculateImpact() {
            const yieldChange = parseFloat(document.getElementById('yieldInput').value) || 0;
            const positionSize = parseFloat(document.getElementById('sizeInput').value) || 500000;
            const confidence = document.getElementById('confidenceInput').value;
            const horizon = document.getElementById('horizonInput').value;

            if (yieldChange === 0) {
                document.getElementById('calcResults').style.display = 'none';
                document.getElementById('calcPlaceholder').style.display = 'flex';
                return;
            }

            const yieldDecimal = yieldChange / 10000;
            const durationImpact = -riskData.modifiedDuration * yieldDecimal * positionSize;
            const convexityAdjustment = 0.5 * riskData.convexity * (yieldDecimal ** 2) * positionSize;
            const totalImpact = durationImpact + convexityAdjustment;

            const varKey = `${horizon}_${confidence}`;
            const baseVar = riskData.parametricVar[varKey];

            document.getElementById('durationResult').textContent = `$${durationImpact.toLocaleString('en-US', {maximumFractionDigits: 0})}`;
            document.getElementById('convexityResult').textContent = `$${totalImpact.toLocaleString('en-US', {maximumFractionDigits: 0})}`;
            document.getElementById('varResult').textContent = `$${baseVar.toLocaleString('en-US', {maximumFractionDigits: 0})}`;

            document.getElementById('calcResults').style.display = 'block';
            document.getElementById('calcPlaceholder').style.display = 'none';
        }

        calculateImpact();
    </script>
</body>
</html>
